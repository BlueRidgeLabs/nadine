{% extends "members/u_base.html" %}
{% load imagetags %}
{% load static %}

{% block sub-title %}{{ user.get_full_name }} | {% endblock %}

{% block style %}
{% endblock %}

{% block content %}
<div class='left-profile col s4'>
  {% if user.profile.photo %}
    {% if ALLOW_PHOTO_UPLOAD %}
      <div class='profile-img-box'>
        <div class='editable-photo prof-img'>
           <a href="{{ user.profile.photo.url }}"><img id='mem-photo' src="{{ user.profile.photo.url }}"></a>
        </div>
        <div id='edit-img'>
          <img id="img-edit" alt='edit image' />
          <h3>Edit Photo</h3>
        </div>
      </div>
      {% else %}
      <div class='prof-img member-photo'>
         <a href="{{ user.profile.photo.url }}"><img id='mem-photo' src="{{ user.profile.photo.url }}"></a>
      </div>
      {% endif %}
    {% else %}
      {% if ALLOW_PHOTO_UPLOAD %}
        <div class='profile-img-box'>
          <div class='editable-photo prof-img'>
            <img id='mem-photo' src="{% static 'img/blank_person.png' %}"/>
          </div>
          <div id='edit-img'>
            <img id="img-edit" alt='edit image' />
            <h3>Edit Photo</h3>
          </div>
        </div>
      {% else %}
        <div class='member-photo'>
          <img id='mem-photo' />
        </div>
      {% endif %}
    {% endif %}

  <div class='tags-box col s12' style='margin-top:5%;'>
    <p style='text-align:center;'> - <strong>Tags</strong> - </p>
    {% include "members/profile_tags.html" %}
  </div>

</div>

<div id='picModal' class='modal'>
  <div class='picModal-content'>
    <div class='picModal-body'>
      <h4>Edit Profile Picture</h4>
      <div class='container' id='pic-modal'>
      </div>
    </div>
  </div>
</div>

<div class='right-profile col s8'>
  <div class='basic-info'>
    <div class='row'>
      <h2 class='col s9 oswald' id='prof-name'>{{ user.get_full_name }}</h2>
      {% if can_edit %}
        <a class='col s1 tooltipped' data-position="bottom" data-tooltip="Edit Profile" href="{% url 'member_edit_profile' user.username %}" style='margin-top:3%;'><img id='edit' alt='edit-icon'/></a>
      {% endif %}
      {% if request.user.profile.is_manager %}
      <a class='col s1 tooltipped' data-position="bottom" data-tooltip="Manage Member" href="{% url 'member_manage' user.username %}" style='margin-top:3%;'><img id='manage' alt='manage-icon' /></a>
      {% endif %}
    </div>

    <div id="public_tab">
      {% include "members/profile_public.html" %}
    </div>

    {% if user.username != request.user.username %}
    <dl>
        <dt>Contact:</dt>
        <dd><a href="{% url 'member_connect' user %}">Connect with this member</a></dd>
    </dl>
    {% endif %}
  </div>

  <div class="clearfix"></div>

  {% block mem_tabs %}
    {% if can_edit %}
      <ul class='collapsible prof-tabs' data-collapsible="accordion">
        <li>
          <div class='collapsible-header' id="private_tab">Your Details</div>
          <div class='collapsible-body' id='private_target'>
            {% include "members/profile_private.html" %}
          </div>
        </li>
        <li>
          <div class='collapsible-header' id='membership_tab'>Membership History</div>
          <div class='collapsible-body' id='membership_target'>
            {% include "members/spinner.html" %}
          </div>
        </li>
        <li>
          <div class='collapsible-header' id='orgs_tab'>Organizations</div>
          <div class='collapsible-body' id='orgs_target'>
            {% include "members/spinner.html" %}
          </div>
        </li>
        <li>
          <div class='collapsible-header' id='activity_tab'>Activity</div>
          <div class='collapsible-body' id='activity_target'>
            {% include "members/spinner.html" %}
          </div>
        </li>
        <li>
          <div class='collapsible-header' id='billing_tab'>Billing History</div>
          <div class='collapsible-body' id='billing_target'>
            {% include "members/spinner.html" %}
          </div>
        </li>
        <li>
          <div class='collapsible-header' id='documents_tab'>Documents</div>
          <div class='collapsible-body' id='documents_target'>
            {% include "members/profile_documents.html" %}
          </div>
        </li>
        <li>
          <div class='collapsible-header' id='devices_tab'>Devices</div>
          <div class='collapsible-body' id='devices_target'>
            {% include "members/spinner.html" %}
          </div>
        </li>
      </ul>
    {% endif %}
  {% endblock %}

</div>

{%block sub-extrajs %}
    <script>
        function load_tab(div_id, url) {
          $.get(url, {}, function(content) {
            div = $(div_id);
            div.html(content);
            console.log("div_id: " + div_id);
          });
        }

        function onclick_tab(tab, url) {
          $(tab + "_tab").on("click", function(e) {
              e.preventDefault();
              load_tab(tab + "_target", url);
          });
        }

        function get_orientation(img) {
          if ((img.width() < img.height()) && img.width() > 1) {
            $('#mem-photo').attr('class', 'portrait');
          }
        }

        $(document).ready(function() {
          $('body').css('background-color', 'RGBA(239, 238, 231, 1)');
          $('.tooltipped').tooltip({delay: 50});
          $('.collapsible').collapsible();
          $('.chips').material_chip();
          $('.button-collapse').sideNav();

          var img = $('#mem-photo');
          get_orientation(img);

          onclick_tab("#membership", "{% url 'member_profile_membership' user.username %}");
          onclick_tab("#activity", "{% url 'member_profile_activity' user.username %}");
          onclick_tab("#orgs", "{% url 'member_profile_orgs' user.username %}");
          onclick_tab("#billing", "{% url 'member_profile_billing' user.username %}");
          onclick_tab("#devices", "{% url 'member_profile_devices' user.username %}");

    			$('#edit-img').on('click', function(e) {
            e.preventDefault();
            get_tab("{% url 'member_edit_pic' user.username %}", '#pic-modal');
            $('#picModal').css('display', 'block');
          });

          $('.collapsible-header').click(function(e) {
            e.preventDefault();
            var target = $(this).next().attr('id');
            var divID = '#' + target;
            $('html, body').animate({
                scrollTop: e.screenY
            }, 1000);
          })

          // TODO finish responsive footer by testing on a device
  				if($('.main').height() < 990) {
            $('footer').attr('class', 'sticky-footer');
  				} else {
  					if($('footer').hasClass('sticky-footer')) {
              $('footer').attr('page-footer main-footer');
  					}
  				}
        });
    </script>
{% endblock %}

{% endblock %}
