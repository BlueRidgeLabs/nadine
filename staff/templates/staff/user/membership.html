{% extends "staff/user/base.html" %}
{% load static %}

{% block sub-title %}Membership | {% endblock %}

{% block style %}
  #page-message {
    font-size: 1.5em;
    color: #933;
    margin: 20px 0px;
  }

  table td {
    border-bottom: none;
    text-align: inherit;
  }
{% endblock %}

{% block sub-head %}
  <link rel="stylesheet" href="{% static 'staff/c3/c3.min.css' %}" />
  <script src="{% static 'staff/c3/date.min.js' %}"></script>
  <script src="{% static 'staff/c3/d3.min.js' %}" charset="utf-8"></script>
  <script src="{% static 'staff/c3/c3.min.js' %}"></script>
{% endblock %}


{% block content %}

<script>
    $(function() {
        $('#id_start_date').datepicker({ dateFormat: "yy-mm-dd" });
        $('#id_end_date').datepicker({ dateFormat: "yy-mm-dd" });
    });
</script>

<script type="text/javascript">

$(document).ready(function() {
	 var formData = {
		 {% for plan in membership_plans %}
		  '{{plan.id}}':{ 'monthly_rate':{{plan.monthly_rate}}, 'dropin_allowance':{{plan.dropin_allowance}}, 'daily_rate':{{plan.daily_rate}},
								'has_desk':'{{plan.has_desk}}' },
		 {% endfor %}
	 }

	 $('#id_membership_plan').change(function() {
		  var value = $(this).val();
		  var new_values = formData[value];
		  $('#id_monthly_rate').val(new_values['monthly_rate']);
		  $('#id_dropin_allowance').val(new_values['dropin_allowance']);
		  $('#id_daily_rate').val(new_values['daily_rate']);
		  if (new_values['has_desk']=='True') {
			  $('#id_has_desk').attr('checked', 'checked');
		  } else {
			  $('#id_has_desk').removeAttr('checked');
		  }
	 });

	$('#end_today').click(function() {
		$('#id_end_date').val('{{today}}');
	});
	$('#end_last').click(function() {
		$('#id_end_date').val('{{ last }}');
	});

})
</script>

<h4>{% if membership %} Update {% else %} Add {% endif %} Membership for <a href="{% url 'staff:user:detail' user.username %}">{{ user.get_full_name }}</a></h4>

{% if messages %}
<div class="messages">
	{% for message in messages %}
		<div {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</div>
	{% endfor %}
</div>
{% endif %}


<div id="membership_form">
	<form name="membership_form" enctype="multipart/form-data" action='.' method='post'>
		{% if membership %}{{ membership_form.membership_id }}{% endif %}
		{{ membership_form.username }}
		<table id="membership">
			<tr class="row-even">
				<td class='mem-title' nowrap>Membership Plan</td>
				<td style="text-align:left;">
					{% if membership %}
						{{ membership.membership_plan }}
						{{ membership_form.membership_plan.as_hidden }}
					{% else %}
						{{ membership_form.membership_plan }}
					{% endif %}
				</td>
				<td style="width:60%;">{{ membership_form.membership_plan.errors }}</td>
			</tr>
    </table>
    <table>
      <tr class="row-odd">
				<td class='date-title'>Start Date</td>
				<td class='date-input' style="text-align:left;">
					{% if membership %}
						{{ membership.start_date }}
						{{ membership_form.start_date.as_hidden }}
					{% else %}
						{{ membership_form.start_date }}
					{% endif %}
				</td>
        <td class='date-title'>End Date</td>
				<td class='date-input' style="text-align:left;">{{ membership_form.end_date }} [ <a id="end_last">last</a> | <a id="end_today">today</a> ]</td>
      </tr>
      <tr class="row-odd">
				<td>{{ membership_form.start_date.errors }}</td>
        <td></td>
				<td>{{ membership_form.end_date.errors }}</td>
        <td></td>
			</tr>
			<tr class="row-even">
				<td class='mem-title' nowrap>Monthly Rate</td>
				<td class='mem-input'>
					{% if membership %}
						$ {{ membership.monthly_rate }}
						{{ membership_form.monthly_rate.as_hidden }}
					{% else %}
						$ {{ membership_form.monthly_rate }}
					{% endif %}
				</td>
        <td class='mem-title' nowrap>Drop-in Allowance</td>
				<td class='mem-input'>
					{% if membership %}
						{{ membership.dropin_allowance }}
						{{ membership_form.dropin_allowance.as_hidden }}
					{% else %}
						$ {{ membership_form.dropin_allowance }}
					{% endif %}
				</td>
			</tr>
      <tr class="row-even">
				<td>{{ membership_form.monthly_rate.errors }}</td>
        <td></td>
				<td>{{ membership_form.dropin_allowance.errors }}</td>
        <td></td>
			</tr>
    </table>
    <table>
			<tr class="row-odd">
				<td class='mem-title' nowrap>Daily Rate</td>
				<td class='mem-input'>
					{% if membership %}
						$ {{ membership.daily_rate }}
						{{ membership_form.daily_rate.as_hidden }}
					{% else %}
						$ {{ membership_form.daily_rate }}
					{% endif %}
				</td>
        <td class='mem-title' nowrap>Extras</td>
				<td style="text-align:left;">
					{% if membership %}
						{% if membership.has_desk %}<span style="margin-right:2em;">&check; Desk</span>{% endif %}
						{% if membership.has_key %}<span style="margin-right:2em;">&check; Key</span>{% endif %}
						{% if membership.has_mail %}<span style="margin-right:2em;">&check; Mail</span>{% endif %}
						{{ membership_form.has_desk.as_hidden }}
						{{ membership_form.has_key.as_hidden }}
						{{ membership_form.has_mail.as_hidden }}
					{% else %}
						<span style="margin-right:2em;">
              <label for='has_desk'>Desk</label>
              {{ membership_form.has_desk }}</span>
						<span style="margin-right:2em;">{{ membership_form.has_key }} Key</span>
						<span style="margin-right:2em;">{{ membership_form.has_mail }} Mail</span>
					{% endif %}
				</td>
			</tr>
      <tr>
        <td>{{ membership_form.daily_rate.errors }}</td>
      </tr>
    </table>
    <table>
			<tr class="row-even">
				<td class='mem-title'>Paid by</td>
				<td class='mem-input' style="text-align:left;">{{ membership_form.paid_by }}</td>
				<td>{{ membership_form.paid_by.errors }}</td>
			</tr>
			<tr class="row-odd">
				<td>Note</td>
				<td class='notes' style="text-align:left;">{{ membership_form.note }}</td>
				<td>{{ membership_form.note.errors }}</td>
			</tr>
	      <tr><td></td><td><input type="submit" value="Submit" /></td></tr>
	   </table>
	   {% csrf_token %}
	</form>
</div>

<div id="membership_list">
</div>
{% endblock %}

{% block extrajs %}
<script>
  $(document).ready(function() {
    $('.button-collapse').sideNav();
		$('.collapsible').collapsible();

    $('#id_membership_plan').attr('class', 'browser-default');
    $('#id_paid_by').attr('class', 'browser-default');
    $('#id_has_desk').attr('class', 'browser-default');
  });
</script>
{% endblock %}
