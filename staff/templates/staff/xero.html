{% extends "staff/staff_base.html" %}
{% load static %}

{% block sub-title %}Xero for {{ member.first_name }} {{ member.last_name }} | {% endblock %}

{% block style %}
nav #members-tab { background: #FBD850; color: black; }
{% endblock %}

{% block content %}
{% include "staff/member_menu.frag" %}	 

<h2>Xero Data for <a href="{% url 'staff.views.member_detail_user' user.username %}">{{ user.get_full_name }}</a>:</h2>

{% if messages %}
<div class="messages">
	{% for message in messages %}
		<div {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</div>
	{% endfor %}
</div>
{% endif %}

{% if not xero_contact %}
	<h3>Contact Not Found - Searching</h3>
	<table>
		<tr>
			<th>Name</th>
			<th>ContactID</th>
			<th></th>
		</tr>
		{% for c in xero_contact_search %}
			<tr class="{% cycle 'row-even' 'row-odd' %}">
				<td>{{ c.Name }}</td>
				<td>{{ c.ContactID }}</td>
				<td>
					<form method="POST" action="." onSubmit="return confirm('Are you sure?');">
						<input type="hidden" name="xero_id" value="{{ c.ContactID }}"/>
						<input type="Submit" name="action" value="Link"/>
						{% csrf_token %}
					</form>
				</td>
			</tr>
		{% endfor %}
		<form method="POST" action=".">
		<tr class="{% cycle 'row-even' 'row-odd' %}">
			<td></td>
			<td><input name="xero_id" size="45" value="{{ c.ContactID }}"/></td>
			<td><input type="Submit" name="action" value="Link"/></td>
		</tr>
		{% csrf_token %}
	</form>
	</table>
{% else %}
	<table>
		<tr>
			<th>ContactID</th>
			<!--<th>Last Sync</th>-->
		</tr>
		<tr>
			<td nowrap><a href="https://go.xero.com/Contacts/View.aspx?contactID={{ xero_contact.xero_id }}">{{ xero_contact.xero_id }}</a></td>
			<!--<td>{{ xero_contact.last_sync }}</td>-->
		</tr>
	</table>

	<h3>Invoices</h3>
	<table>
		<tr>
			<th>Date</th>
			<th>Invoice</th>
			<th>Amount</th>
			<th>Status</th>
			<th></th>
		{% for i in invoices %}
			<tr>
				<td>{{ i.DateString|slice:"10" }}</td>
				<td><a href="https://go.xero.com/AccountsReceivable/View.aspx?InvoiceID={{ i.InvoiceID }}">{{ i.InvoiceNumber }}</a></td>
				<td>${{ i.Total }}0</td>
				<td>{{ i.Status }}</td>
				<td></td>
			</tr>
		{% endfor %}
	</table>
{% endif %}

{% endblock %}
