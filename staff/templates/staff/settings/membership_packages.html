{% extends "staff/settings/base.html" %}

{% block content %}
  <h4>Membership Packages</h4>
  <form action='.' method='POST'>
  <table>
    <tr>
      <td>
        <strong>Package Name:</strong>
      </td>
      <td>
        <input type='text' maxlength="128" name='name' />
      </td>
      <td>
        <input id='enabled' type='checkbox' name='enabled' />
        <label for='enabled'>Enable?</label>
      </td>
    </tr>
  </table>
  <table>
    <tr>
      <th>Resource</th>
      <th>Allowance</th>
      <th>Monthly Rate</th>
      <th>Overage Rate</th>
      <th></th>
    </tr>
    {{ package_formset.management_form }}
    {% for package_form in package_formset %}
      <tr class='package_formset'>
        <td>
          {{ package_form.resource }}
        </td>
        <td>
          {{ package_form.allowance }}
        </td>
        <td>
          {{ package_form.monthly_rate }}
        </td>
        <td>
          {{ package_form.overage_rate}}
        </td>
      </tr>
    {% endfor %}
  </table>
  <button type='submit'>Create</button>
  {% csrf_token %}
  </form>
  <table>
    <tr>
      <th>Package Name</th>
      <th>Resource</th>
      <th>Allowance</th>
      <th>Monthly Rate</th>
      <th>Overage Rate</th>
      <th></th>
    </tr>
    <!-- <tr>
      <form action='.' method='POST'>
        <input type='hidden' name='add' />

        <td>
          <button type='submit'>Add</button>
        </td>
        {% csrf_token %}
      </form>
    </tr> -->
    {% for package in packages %}
      <tr class="{% cycle 'row-even' 'row-odd' %}">
        <td>
          {% ifchanged %}
            {{ package.package }}
          {% endifchanged %}
        </td>
        <td>{{ package.resource }}</td>
        <td>{{ package.allowance }}</td>
        <td>{{ package.monthly_rate }}</td>
        <td style='text-align: center;'>{{ package.overage_rate }}</td>
        <td>
          <button class='edit-package' value='{{ package.id }}'>Edit</button>
        </td>
      </tr>
      <tr class="edit-pkg {% cycle 'row-even' 'row-odd' %}" id='edit-{{ package.id }}'>
        <form action='.' method='POST'>
          <td><input type='hidden' name='edit' /></td>
          <td>
            <input type='hidden' name='pkg_id' value='{{ package.id }}' />
          </td>
          <td>
            {{ package_form.allowance }}
          </td>
          <td>
            {{ package_form.monthly_rate }}
          </td>
          <td>
            {{package_form.overage_rate }}
          </td>
          <td>
            <button type='submit'>Update</button>
          </td>
          <td>
            <a class='cancel'>Cancel</a>
          </td>
          {% csrf_token %}
        </form>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5"><i>No Membership Packages</i></td>
      </tr>
    {% endfor %}
  </table>
{% endblock %}

{% block extrajs %}
<script>
  $(document).ready(function() {
    $('.button-collapse').sideNav();
    $('.collapsible').collapsible();
    $('.edit-pkg').hide();

    $('.edit-package').click(function(e) {
      e.preventDefault();
      id = $(this).val();
      $('#edit-' + id).toggle();
    })

    $('.package_formset').formset({
      addText:'Add Another',
      deleteText: 'Delete'
    })

    $('.cancel').click(function(e) {
      e.preventDefault();
      $('.edit-pkg').hide();
    })

    {% for message in messages %}
      {% if message.tags == 'error' %}
        Materialize.toast('{{ message }}', 60000, 'error-msg msg');
      {% else %}
        Materialize.toast('{{ message }}', 3000, '{{ message.tags }}-msg msg');
      {% endif %}
    {% endfor %}

    $(document).on('click', '#toast-container .toast', function() {
      $(this).fadeOut(function(){
        $(this).remove();
      });
    });
  });
</script>
{% endblock %}
